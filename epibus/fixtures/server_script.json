[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-10 14:51:15.470891",
  "module": "EpiBus",
  "name": "Staging to Receiving",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "",
  "script": "# Get context from the action\ncontext = frappe.flags.modbus_context\nif not context:\n    frappe.throw(\"No context provided\")\n    \ndevice = context.get('device')\nparams = context.get('params', {})\n\nbin_number = params.get('bin_number')\nif not bin_number:\n    frappe.log_error(\"Bin number not provided\", \"Staging Robot Error\")\n    frappe.throw(\"Bin number required\")\n    \nfrappe.logger().info(f\" Starting staging to receiving sequence for bin {bin_number}\")\n\n# Read cycle running status\ncycle_running = device.read_signal(\"CYCLE_RUNNING\")\nif not cycle_running:\n    frappe.log_error(\"PLC cycle not running\", \"Staging Robot Error\")\n    frappe.throw(\"PLC cycle not running\")\n    \n# Set pick bin and destination signals\ndevice.write_signal(f\"PICK_BIN_{bin_number}\", True)\ndevice.write_signal(\"TO_RECEIVING_STA_1\", True)\n\nfrappe.response[\"message\"] = {\n    \"status\": \"success\",\n    \"value\": f\"Initiated staging to receiving sequence for bin {bin_number}\"\n}",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-10 18:19:52.532020",
  "module": "EpiBus",
  "name": "Receiving to Staging",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Modbus Action",
  "script": "# Get context from the action\ncontext = frappe.flags.modbus_context\nif not context:\n    frappe.throw(\"No context provided\")\n    \ndevice = context.get('device')\nparams = context.get('params', {})\n\nbin_number = params.get('bin_number')\nif not bin_number:\n    frappe.log_error(\"Bin number not provided\", \"Staging Robot Error\")\n    frappe.throw(\"Bin number required\")\n    \nfrappe.logger().info(f\" Starting receiving to staging sequence for bin {bin_number}\")\n\n# Read cycle running status\ncycle_running = device.read_signal(\"CYCLE_RUNNING\")\nif not cycle_running:\n    frappe.log_error(\"PLC cycle not running\", \"Staging Robot Error\")\n    frappe.throw(\"PLC cycle not running\")\n    \n# Set pick bin and source signals\ndevice.write_signal(f\"PICK_BIN_{bin_number}\", True)\ndevice.write_signal(\"FROM_RECEIVING\", True)\n\nfrappe.response[\"message\"] = {\n    \"status\": \"success\",\n    \"value\": f\"Initiated receiving to staging sequence for bin {bin_number}\"\n}\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-10 18:25:15.553053",
  "module": "EpiBus",
  "name": "Assembly to Staging",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "# Get context from the action\ncontext = frappe.flags.modbus_context\nif not context:\n    frappe.throw(\"No context provided\")\n    \ndevice = context.get('device')\nparams = context.get('params', {})\n\nbin_number = params.get('bin_number')\nif not bin_number:\n    frappe.log_error(\"Bin number not provided\", \"Staging Robot Error\")\n    frappe.throw(\"Bin number required\")\n    \nfrappe.logger().info(f\" Starting assembly to staging sequence for bin {bin_number}\")\n\n# Read cycle running status\ncycle_running = device.read_signal(\"CYCLE_RUNNING\")\nif not cycle_running:\n    frappe.log_error(\"PLC cycle not running\", \"Staging Robot Error\")\n    frappe.throw(\"PLC cycle not running\")\n    \n# Set pick bin and source signals\ndevice.write_signal(f\"PICK_BIN_{bin_number}\", True)\ndevice.write_signal(\"FROM_ASSEMBLY\", True)\n\nfrappe.response[\"message\"] = {\n    \"status\": \"success\",\n    \"value\": f\"Initiated assembly to staging sequence for bin {bin_number}\"\n}\n",
  "script_type": "API"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-02-10 18:26:16.764389",
  "module": "EpiBus",
  "name": "Monitor Sequence",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": null,
  "script": "# Get context from the action\ncontext = frappe.flags.modbus_context\nif not context:\n    frappe.throw(\"No context provided\")\n    \ndevice = context.get('device')\n\n# Check for error signal\nerror_state = device.read_signal(\"PICK_ERROR\")\nif error_state:\n    frappe.log_error(\"Pick error detected\", \"Staging Robot Error\")\n    frappe.throw(\"Pick error detected\")\n    \n# Read completion signals\nto_receiving = device.read_signal(\"PICK_TO_RECEIVING_COMPLETE\")\nto_staging = device.read_signal(\"PICK_TO_STAGING_COMPLETE\")\nto_assembly = device.read_signal(\"PICK_TO_ASSEMBLY_COMPLETE\")\n\nif to_receiving:\n    status = \"Staging to receiving complete\"\nelif to_staging:\n    status = \"Movement to staging complete\"\nelif to_assembly:\n    status = \"Staging to assembly complete\"\nelse:\n    status = \"Sequence in progress\"\n    \nfrappe.logger().info(f\" Sequence status: {status}\")\n\nfrappe.response[\"message\"] = {\n    \"status\": \"success\",\n    \"value\": status\n}",
  "script_type": "API"
 }
]